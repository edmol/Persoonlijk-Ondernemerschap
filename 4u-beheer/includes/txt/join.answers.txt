Copied from:
http://platon.sk/forum/projects/viewtopic.php?t=472


phpMyEdit General     'join' option question
doug     Joined: 10 Feb 2003   Posts: 213   Location: Denver, Colorado (USA)
Post Posted: 01 Sep 2004 14:19
Back to top  Reply with quote  Edit/Delete this post  Delete this post  View IP of poster

The 'join' option available in the CVS version of the class file leaves me somewhat confused. In List mode of the 'article' table shown below, I would like to configure a virtual (dummy) field that takes 'article.title_id' to the 'author_links' table and then displays 'author_links.author_id' in the dummy field (or the author's name from the 'author' table if it is possible to carry the lookup one step further). Thanks in advance for any reply.

Code:
CREATE TABLE `author_links` (
  `title_id` int(11) NOT NULL default '0',
  `author_id` int(11) NOT NULL default '0',
  PRIMARY KEY  (`title_id`,`author_id`),
  KEY `title_id` (`title_id`),
  KEY `author_id` (`author_id`)
) TYPE=MyISAM;

CREATE TABLE `author` (
  `author_id` int(11) NOT NULL auto_increment,
  `name` varchar(150) NOT NULL default '',
  `personal_names` varchar(50) default NULL,
  `dob_dod` varchar(10) default NULL,
  `appr_y_n` tinyint(1) NOT NULL default '1',
  `approved_author` varchar(100) default NULL,
  `appr_author_id` int(11) default NULL,
  PRIMARY KEY  (`author_id`),
  KEY `name` (`name`)
) TYPE=MyISAM;

CREATE TABLE `article` (
  `title_id` int(11) NOT NULL auto_increment,
  `material` char(1) NOT NULL default 'J',
  `title` varchar(255) NOT NULL default '',
  `journal_title` varchar(255) NOT NULL default '',
  `monograph_title` varchar(255) default NULL,
  `series_title` varchar(255) default NULL,
  `place_publ` varchar(40) default NULL,
  `publisher` varchar(200) default NULL,
  `publish_date` varchar(20) NOT NULL default '',
  `vol_no` varchar(15) default NULL,
  `pp` varchar(20) default NULL,
  `notes` text,
  PRIMARY KEY  (`title_id`),
  KEY `journal_title` (`journal_title`),
  KEY `title` (`title`),
  KEY `title_id` (`title_id`)
) TYPE=MyISAM;


 
michal     Joined: 17 Jun 2003   Posts: 223   Location: Slovakia
Post Posted: 16 Sep 2004 01:00
Back to top  Reply with quote  Edit/Delete this post  Delete this post  View IP of poster

well, isn't 'values' option sufficient? (and create dummy field for article.title_id using 'sql', if needed). or i misunderstood something ?

 
doug     Joined: 10 Feb 2003   Posts: 213   Location: Denver, Colorado (USA)
Post Posted: 08 Nov 2004 05:58
Back to top  Reply with quote  Edit/Delete this post  Delete this post  View IP of poster

I still don't get it and/or can't find a working example for situations where the field name in the lookup table is the same name as one of the fields in the main table. Long ago, I had a working example but have lost track of it since I do not need this very often.

If someone could post a working example of a lookup where the field name in the lookup table is the same name as one of the fields in the main table, I would appreciate it.

I've read the documentation quoted below and find myself unable to make some working code using this documentation.

Quote:
Advanced joining

Sometimes you want to restrict table joining on the output. This is important in case where ['values']['column'] is not unique in ['values']['table']. For this purpose, you can use $opts['fdd']['col_name']['values']['join'] option.

These variables are available in this option.

$main_table -- alias of the main table
$main_column -- join column in the main table
$join_table -- alias of the values table
$join_column -- join column in the values table
$join_description -- description column in the values table

phpMyEdit will create by default $main_table.$main_column = $join_table.$join_column join, what is sufficient the most cases. However you may extend it with additional conditions as well.

Example 4-17. Table lookup with advanced joining

$opts['fdd']['col_name']['values']['join']
= '$main_table.$main_column = $join_table.$join_column AND '
. '$main_table.another_col = $join_table.another_col';


 
hbernard     Joined: 23 Mar 2003   Posts: 129   Location: FRANCE
New post Posted: 08 Nov 2004 14:33
Back to top  Reply with quote  Edit/Delete this post  Delete this post  View IP of poster

Doug,

- you can't use $main_column in a dummy field (yes, stating the obvious, but, in case of ...
- try to use 'join' without var substitution :
something like :
PMEtable0.my_main_column = PMEjoin4.my_join_column
- don't forget :
You have to set both
['values']['column'] AND ['values']['description']
even if they have the same values (see #220)
- You should read :
#220
and
#272

I will try to build an example for your schema.

_________________
hbernard - phpMyEdit updater.
 
hbernard     Joined: 23 Mar 2003   Posts: 129   Location: FRANCE
New post Posted: 08 Nov 2004 14:54
Back to top  Reply with quote  Edit/Delete this post  Delete this post  View IP of poster

This works for me when I insert it at the top of field definition.

Don't move 'join0' and 'join1' (they don't display anything, but their respective position are important for PMEjoinX numbering.

You may put the field 'a_field_from_author' anywhere you want...

Or did I miss something ?

Code:
$opts['fdd']['join0'] = array(
  'options'  => '',
   'input' => 'VR',
   'values'   => Array(
      'table' => 'author_links',
      'column' => 'title_id',
      'description' => 'title_id',
      'join' => '$main_table.title_id = $join_table.title_id')
);

$opts['fdd']['join1'] = array(
  'options'  => '',
   'input' => 'VR',
   'values'   => Array(
      'table' => 'author',
      'column' => 'author_id',
      'description' => 'author_id',
      'join' => 'PMEjoin0.author_id = $join_table.author_id')
);

$opts['fdd']['a_field_from_author'] = array(
   'name'  => 'Author Name',
   'input' => 'VR',
   'options'  => 'LFV',
   'sql' => 'PMEjoin1.name'
);


_________________
hbernard - phpMyEdit updater.
 